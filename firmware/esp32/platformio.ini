; PlatformIO Project Configuration File
; Roxy RedLight v2.0 - Dual Wavelength PBM Helmet
;
; Board: LilyGO T-Display S3 (ESP32-S3 with 1.9" LCD)
;
; Build: pio run
; Upload: pio run --target upload
; Monitor: pio device monitor

[env:lilygo-t-display-s3]
platform = espressif32
board = lilygo-t-display-s3
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Build flags for T-Display S3
build_flags =
    -DCORE_DEBUG_LEVEL=1
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DBOARD_HAS_PSRAM
    ; TFT_eSPI configuration for T-Display S3
    -DUSER_SETUP_LOADED=1
    -DST7789_DRIVER=1
    -DTFT_WIDTH=170
    -DTFT_HEIGHT=320
    -DTFT_MOSI=11
    -DTFT_SCLK=12
    -DTFT_CS=6
    -DTFT_DC=7
    -DTFT_RST=5
    -DTFT_BL=38
    -DLOAD_GLCD=1
    -DLOAD_FONT2=1
    -DLOAD_FONT4=1
    -DLOAD_FONT6=1
    -DLOAD_FONT7=1
    -DLOAD_FONT8=1
    -DLOAD_GFXFF=1
    -DSMOOTH_FONT=1
    -DSPI_FREQUENCY=80000000
    -DSPI_READ_FREQUENCY=20000000

; Libraries
lib_deps =
    TFT_eSPI
    Preferences

; Board-specific settings
board_build.arduino.memory_type = qio_opi
board_build.flash_mode = qio
board_build.psram_type = opi

; =============================================================================
; NATIVE TEST ENVIRONMENT
; Run unit tests on host machine without hardware
; Usage: pio test -e native
; Usage: pio test -e native -f test_safety    (safety tests only)
; Usage: pio test -e native -f test_ui        (UI tests only)
; =============================================================================

[env:native]
platform = native
build_flags =
    -DUNITY_INCLUDE_DOUBLE
    -DUNITY_DOUBLE_PRECISION=1e-12
lib_deps =
    throwtheswitch/Unity@^2.5.2
test_build_src = true
lib_extra_dirs = lib
; Exclude hardware tests from native environment
test_ignore = test_hardware

; =============================================================================
; HARDWARE TEST ENVIRONMENT
; Run on-device tests to verify circuit connections
; Usage: pio test -e hardware
; Requires: Actual T-Display S3 connected via USB
; =============================================================================

[env:hardware]
platform = espressif32
board = lilygo-t-display-s3
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_flags =
    -DCORE_DEBUG_LEVEL=1
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
lib_deps =
    throwtheswitch/Unity@^2.5.2
; Only run hardware tests
test_filter = test_hardware
